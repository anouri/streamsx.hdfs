/* Copyright (C) 2015, International Business Machines Corporation */
/* All Rights Reserved */
use com.ibm.streamsx.hdfs::HadoopReader;
use hdfs.test.common::CheckCount;

/**
 * Use to check input file reading for both compressed and uncompressed files.    
 * Also checks that key-value output, key only, and value only output works.
 */

composite ReadAndCount {

param expression<rstring> $inputFile: getSubmissionTimeValue("inputFile");
expression<rstring> $configFile: getSubmissionTimeValue("configFile");
expression<list<int32>> $recordCountArray: (list<int32>)getSubmissionTimeValue("recordCountArray");

graph

stream<int64 key, rstring value> Both = HadoopReader() {
param 
file: $inputFile;
configResources: $configFile;
fileType:sequence;
}

() as bothCheck = CheckCount(Both) {
param
tupleCount: $recordCountArray[getChannel()];
}
}

composite Main {

graph
@parallel(width=2)
() as channel = ReadAndCount() {

}

}

